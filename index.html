<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Package Panic</title>
  <link rel="stylesheet" href="/assets/css/style.css" />

  <style>
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      background-color: #000;
      color: #fff;
      flex-wrap: wrap;
    }

    .site-title {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .brand-logo {
      height: 56px;
      width: auto;
    }

    .account-info {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .user-line {
      font-size: 1.8em;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .award-icon {
      height: 40px;
      width: auto;
    }

    #account-action {
      font-size: 1em;
      text-decoration: underline;
      cursor: pointer;
    }

    .footer-branding {
      text-align: center;
      margin-top: 30px;
    }

    .footer-logo {
      height: 48px;
      width: auto;
      margin-top: 6px;
    }

    @media (max-width: 768px) {
      .header {
        flex-direction: column;
        align-items: flex-start;
      }

      .account-info {
        justify-content: flex-start;
        gap: 8px;
      }

      .user-line {
        font-size: 1.5em;
      }

      .site-title {
        flex-direction: column;
        align-items: flex-start;
      }

      .brand-logo {
        height: 48px;
      }
    }
  </style>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, doc, getDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDVk9j5oxhJ8Dp21fNHyb2q_GLUoA9q5q8",
      authDomain: "packagepanic-8d51b.firebaseapp.com",
      projectId: "packagepanic-8d51b",
      storageBucket: "packagepanic-8d51b.appspot.com",
      messagingSenderId: "1013005031900",
      appId: "1:1013005031900:web:3a348735c268ac6ece9719"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    async function loadAwardDefinitions() {
      const snapshot = await getDocs(collection(db, "award_definitions"));
      const map = {};
      snapshot.forEach(doc => map[doc.id] = doc.data());
      return map;
    }

    window.loadAwardDefinitions = loadAwardDefinitions;

    function getAwardIcons(awards) {
      const icons = [];
      const push = (file) => file && icons.push(`/assets/icons/${file}`);

      const priority = [
        "star_juggernaut",
        "package_gold", "package_silver", "package_bronze",
        "retry_junky",
        "conveyor_shiny", "conveyor_used", "conveyor_antique",
        "survivor_panic",
        "code_of_arms",
        "lab_rat",
        "binoculars",
        "cup_platinum", "cup_gold", "cup_silver", "cup_bronze",
        "thinking_outside_the_box",
        "royal_artist",
        "alien_frank",
        "binge_watcher"
      ];

      priority.forEach(key => {
        if (awards[key]) push(`Award ${awards[key]}.png`);
      });

      return icons;
    }

    window.addEventListener('DOMContentLoaded', () => {
      const accountAction = document.getElementById("account-action");
      const userInfo = document.getElementById("user-info");

      onAuthStateChanged(auth, async (user) => {
        if (user) {
          const uid = user.uid;
          const userDoc = await getDoc(doc(db, "users", uid));

          if (userDoc.exists()) {
            const data = userDoc.data();
            const username = data.username || "User";
            const awards = data.awards || {};
            const awardIcons = getAwardIcons(awards);

            userInfo.style.display = "flex";
            userInfo.innerHTML = `
              <div class="user-line">
                ${username}
                ${awardIcons.map(src => `<img class="award-icon" src="${src}" alt="award" />`).join(" ")}
              </div>
            `;

            accountAction.textContent = "Log Out";
            accountAction.onclick = async () => {
              await signOut(auth);
              location.reload();
            };
          }
        } else {
          userInfo.style.display = "none";
          accountAction.textContent = "Login / Create Account";
          accountAction.onclick = () => {
            window.location.href = "/pages/account.html";
          };
        }
      });
    });
  </script>
</head>
<body>
  <!-- ...body content stays unchanged... -->
</body>
</html>
