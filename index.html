<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Package Panic</title>
  <link rel="stylesheet" href="/assets/css/style.css" />

  <style>
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      background-color: #000;
      color: #fff;
      flex-wrap: wrap;
    }

    .header h1 {
      margin: 0;
      font-size: 2.2em;
    }

    .account-info {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .user-line {
      font-size: 1.8em;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .award-icon {
      height: 40px;
      width: auto;
    }

    #account-action {
      font-size: 1em;
      text-decoration: underline;
      cursor: pointer;
    }

    @media (max-width: 768px) {
      .header {
        flex-direction: column;
        align-items: flex-start;
      }

      .account-info {
        justify-content: flex-start;
        gap: 8px;
      }

      .user-line {
        font-size: 1.5em;
      }
    }
  </style>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDVk9j5oxhJ8Dp21fNHyb2q_GLUoA9q5q8",
      authDomain: "packagepanic-8d51b.firebaseapp.com",
      projectId: "packagepanic-8d51b",
      storageBucket: "packagepanic-8d51b.appspot.com",
      messagingSenderId: "1013005031900",
      appId: "1:1013005031900:web:3a348735c268ac6ece9719"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    function getAwardIcons(awards) {
      const icons = [];

      const pushIfHas = (field, filename) => {
        if (awards[field]) icons.push(`/assets/icons/${filename}`);
      };

      const tierSelect = (tiers) => {
        for (let i = tiers.length - 1; i >= 0; i--) {
          if (awards[tiers[i].field]) return tiers[i].filename;
        }
        return null;
      };

      const order = [
        { type: "single", field: "juggernaut_award", filename: "Award Juggernaut Star.png" },
        { type: "tiered", fields: [
          { field: "package_bronze", filename: "Award Package Bronze.png" },
          { field: "package_silver", filename: "Award Package Silver.png" },
          { field: "package_gold", filename: "Award Package Gold.png" }
        ]},
        { type: "single", field: "retry_junky", filename: "Award Retry Junky.png" },
        { type: "tiered", fields: [
          { field: "conveyor_shiny", filename: "Award Shiny Conveyor.png" },
          { field: "conveyor_worn", filename: "Award Worn Conveyor.png" },
          { field: "conveyor_antique", filename: "Award Antique Conveyor.png" }
        ]},
        { type: "single", field: "panic_survivor", filename: "Award Panic Survivor.png" },
        { type: "single", field: "code_of_arms", filename: "Award Code of Arms.png" },
        { type: "single", field: "lab_rat", filename: "Award Lab Rat.png" },
        { type: "single", field: "binoculars", filename: "Award Binoculars Ad Watch.png" },
        { type: "tiered", fields: [
          { field: "cup_bronze", filename: "Award Cup Bronze.png" },
          { field: "cup_silver", filename: "Award Cup Silver.png" },
          { field: "cup_gold", filename: "Award Cup Gold.png" },
          { field: "cup_platinum", filename: "Award Cup Platinum.png" }
        ]},
        { type: "single", field: "outside_the_box", filename: "Award Thinking Outside the Box.png" },
        { type: "single", field: "royal_artist", filename: "Award Royal Artist.png" },
        { type: "single", field: "frank_alien", filename: "Award Frank Alien.png" }
      ];

      order.forEach(entry => {
        if (entry.type === "single") {
          pushIfHas(entry.field, entry.filename);
        } else if (entry.type === "tiered") {
          const icon = tierSelect(entry.fields);
          if (icon) icons.push(`/assets/icons/${icon}`);
        }
      });

      return icons;
    }

    window.addEventListener('DOMContentLoaded', () => {
      const accountAction = document.getElementById("account-action");
      const userInfo = document.getElementById("user-info");

      onAuthStateChanged(auth, async (user) => {
        if (user) {
          const uid = user.uid;
          const userDoc = await getDoc(doc(db, "users", uid));

          if (userDoc.exists()) {
            const data = userDoc.data();
            const username = data.username || "User";
            const awards = data.awards || {};

            const awardIcons = getAwardIcons(awards);

            userInfo.style.display = "flex";
            userInfo.innerHTML = `
              <div class="user-line">
                ${username}
                ${awardIcons.map(src => `<img class="award-icon" src="${src}" alt="award" />`).join(" ")}
              </div>
            `;

            accountAction.textContent = "Log Out";
            accountAction.onclick = async () => {
              await signOut(auth);
              location.reload();
            };
          }
        } else {
          userInfo.style.display = "none";
          accountAction.textContent = "Login / Create Account";
          accountAction.onclick = () => {
            window.location.href = "/pages/account.html";
          };
        }
      });
    });
  </script>
</head>

<body>
  <div class="header">
    <h1>PACKAGE PANIC</h1>
    <div class="account-info">
      <div id="user-info" style="display: none;"></div>
      <div id="account-action">Login / Create Account</div>
    </div>
  </div>

  <div class="tagline">
    You think youâ€™ve got what it takes to out-sort the world? Put your skills to the test and see how you stack up on the leaderboard, compete daily for awards, and in quarterly contests to have your ideas and artwork added to the game! Best of luck to you and oh, try not to panic!
  </div>

  <div class="container">
    <div class="section">
      <h2>Leaderboards:</h2>
      <div class="grid">
        <a class="menu-btn" href="/pages/leaderboard-global.html">Global Leaderboard</a>
        <a class="menu-btn" href="/pages/area51.html">Area51 Leaderboard</a>
      </div>
    </div>

    <div class="section">
      <h2>Account:</h2>
      <div class="grid">
        <a class="menu-btn" href="/pages/stats.html">Stats</a>
        <a class="menu-btn" href="/pages/awards.html">Awards</a>
        <a class="menu-btn" href="/pages/settings.html">Settings</a>
        <a class="menu-btn" href="/pages/premium-account.html">Premium Account</a>
      </div>
    </div>

    <div class="section">
      <h2>Game:</h2>
      <div class="grid">
        <a class="menu-btn" href="/pages/how-to-play.html">How to Play</a>
        <a class="menu-btn" href="/pages/return-to-app.html">Return to App</a>
        <a class="menu-btn" href="/pages/download-app.html">Download App</a>
      </div>
    </div>

    <div class="section">
      <h2>Discussion:</h2>
      <div class="grid">
        <a class="menu-btn" href="https://discord.gg/H8THUeuZgb" target="_blank" rel="noopener noreferrer">Discord</a>
        <a class="menu-btn" href="/pages/contact-us.html">Contact Us</a>
      </div>
    </div>

    <div class="section">
      <h2>Contests:</h2>
      <div class="grid">
        <a class="menu-btn" href="/pages/active-contest.html">Active Contest</a>
        <a class="menu-btn" href="/pages/previous-contest.html">Previous Contests</a>
        <a class="menu-btn" href="/pages/contest-winners.html">Contest Winners</a>
      </div>
    </div>

    <div class="section">
      <h2>From Admin:</h2>
      <div class="grid">
        <a class="menu-btn" href="/pages/patch-notes-bug-fixes.html">Patch Notes / Bug Fixes</a>
        <a class="menu-btn" href="/pages/scheduled-updates.html">Scheduled Updates</a>
      </div>
    </div>
  </div>

  <footer class="site-footer">
    <div class="footer-content">
      <p>&copy; 2025 Games by Brandon. All rights reserved.</p>
      <div class="footer-links">
        <a href="/pages/privacy-policy.html">Privacy Policy</a>
        <span>|</span>
        <a href="/pages/terms-of-service.html">Terms of Service</a>
        <span>|</span>
        <a href="/pages/disclaimer.html">Disclaimer</a>
      </div>
      <p class="footer-disclaimer">Not affiliated with any third-party platforms. This site is independently operated for the game <strong>Package Panic</strong>.</p>
    </div>
  </footer>

  <script>
    document.querySelectorAll('.menu-btn').forEach(btn => {
      btn.addEventListener('click', e => {
        window.location.href = btn.getAttribute('href');
      });
    });
  </script>
</body>
</html>
